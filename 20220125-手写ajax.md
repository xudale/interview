# 20220125-手写ajax



```JavaScript
function request(url, method = 'get', data = {}, withCredentials = true) {
	method = method.toLowerCase()
	const xhr = new XMLHttpRequest()
	return new Promise((resolve, reject) => {
		xhr.onreadystatechange = _ => {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				if (xhr.status == 200) {
					resolve(xhr.responseText)
				} else {
					reject('ajax error')
				}
			}
		}
		xhr.withCredentials = withCredentials
		if (method == 'get') {
			Object.keys(data).forEach((key, index) => {
				url += `${index ? '&' : '?'}${encodeURIComponent(key)}=${encodeURIComponent(data[key])}`
			})
			xhr.open(method, url, true)
			xhr.send()
		} else {
			xhr.open(method, url, true)
			xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
			xhr.send(JSON.stringify(data))
		}
	})
}
```



















